{"version":3,"sources":["../src/mcp-server.ts"],"sourcesContent":["import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';\nimport { z } from 'zod';\nimport * as octokit from '@agentic/triage-trackers/octokit';\n\nconst server = new McpServer({\n    name: 'agentic-triage',\n    version: '1.0.0',\n});\n\n// Issues\nserver.tool(\n    'list_issues',\n    {\n        status: z.enum(['open', 'closed', 'all']).optional().default('open'),\n        limit: z.number().optional().default(50),\n    },\n    async ({ status, limit }) => {\n        try {\n            const query = status === 'all' ? '' : `is:${status}`;\n            const issues = await octokit.searchIssues(query);\n            return {\n                content: [{ type: 'text', text: JSON.stringify(issues.slice(0, limit), null, 2) }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error listing issues: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'get_issue',\n    {\n        id: z.number().describe('Issue number'),\n    },\n    async ({ id }) => {\n        try {\n            const issue = await octokit.getIssue(id);\n            return {\n                content: [{ type: 'text', text: JSON.stringify(issue, null, 2) }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error getting issue #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'create_issue',\n    {\n        title: z.string(),\n        body: z.string().optional(),\n        type: z.enum(['bug', 'feature', 'docs', 'test', 'refactor', 'chore']).optional(),\n        priority: z.enum(['low', 'medium', 'high', 'critical']).optional(),\n        labels: z.array(z.string()).optional(),\n        assignees: z.array(z.string()).optional(),\n    },\n    async (args) => {\n        try {\n            const labels = args.labels || [];\n            if (args.type) labels.push(`type:${args.type}`);\n            if (args.priority) labels.push(`priority:${args.priority}`);\n\n            const issue = await octokit.createIssue({\n                title: args.title,\n                body: args.body || '',\n                labels,\n                assignees: args.assignees,\n            });\n            return {\n                content: [{ type: 'text', text: JSON.stringify(issue, null, 2) }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error creating issue: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'update_issue',\n    {\n        id: z.number(),\n        title: z.string().optional(),\n        body: z.string().optional(),\n        state: z.enum(['open', 'closed']).optional(),\n        labels: z.array(z.string()).optional(),\n        assignees: z.array(z.string()).optional(),\n    },\n    async ({ id, ...updates }) => {\n        try {\n            await octokit.updateIssue(id, updates);\n            return {\n                content: [{ type: 'text', text: `Issue #${id} updated successfully` }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error updating issue #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'close_issue',\n    {\n        id: z.number(),\n        reason: z.string().optional(),\n    },\n    async ({ id, reason }) => {\n        try {\n            await octokit.updateIssue(id, { state: 'closed' });\n            if (reason) {\n                await octokit.addIssueComment(id, `Closing issue: ${reason}`);\n            }\n            return {\n                content: [{ type: 'text', text: `Issue #${id} closed successfully` }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error closing issue #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'search_issues',\n    {\n        query: z.string(),\n    },\n    async ({ query }) => {\n        try {\n            const issues = await octokit.searchIssues(query);\n            return {\n                content: [{ type: 'text', text: JSON.stringify(issues, null, 2) }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error searching issues with query \"${query}\": ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'add_labels',\n    {\n        id: z.number(),\n        labels: z.array(z.string()),\n    },\n    async ({ id, labels }) => {\n        try {\n            await octokit.addIssueLabels(id, labels);\n            return {\n                content: [{ type: 'text', text: `Labels added to issue #${id}` }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error adding labels to issue #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\nserver.tool(\n    'remove_labels',\n    {\n        id: z.number(),\n        labels: z.array(z.string()),\n    },\n    async ({ id, labels }) => {\n        try {\n            const issue = await octokit.getIssue(id);\n            const remaining = issue.labels.filter((l: any) => !labels.includes(typeof l === 'string' ? l : l.name));\n            await octokit.updateIssue(id, { labels: remaining });\n            return {\n                content: [{ type: 'text', text: `Labels removed from issue #${id}` }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error removing labels from issue #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\n// Reviews\nserver.tool(\n    'get_pr_comments',\n    {\n        id: z.number().describe('Pull request number'),\n    },\n    async ({ id }) => {\n        try {\n            const comments = await octokit.getPRReviewComments(id);\n            return {\n                content: [{ type: 'text', text: JSON.stringify(comments, null, 2) }],\n            };\n        } catch (error: any) {\n            return {\n                content: [{ type: 'text', text: `Error getting comments for PR #${id}: ${error.message}` }],\n                isError: true,\n            };\n        }\n    }\n);\n\n// Sprints (stubs for now, will implement if possible)\nserver.tool('list_sprints', {}, async () => {\n    return {\n        content: [{ type: 'text', text: 'Sprint tools not yet implemented' }],\n    };\n});\n\nserver.tool('get_current_sprint', {}, async () => {\n    return {\n        content: [{ type: 'text', text: 'Sprint tools not yet implemented' }],\n    };\n});\n\n/**\n * Start the MCP server\n */\nexport async function runMcpServer() {\n    try {\n        const transport = new StdioServerTransport();\n        await server.connect(transport);\n        console.error('Agentic Triage MCP Server running on stdio');\n    } catch (error) {\n        console.error('Failed to start MCP server:', error);\n        process.exit(1);\n    }\n}\n"],"mappings":"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","names":[]}