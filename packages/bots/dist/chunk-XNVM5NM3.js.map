{"version":3,"sources":["../src/curator.ts"],"sourcesContent":["/**\n * @curator Bot - Issue triage, labeling, and assignment\n */\n\nimport type { Bot, BotContext, BotResponse } from './router.js';\n\nexport class CuratorBot implements Bot {\n    name = 'curator';\n    triggers = ['@curator', '/curator', '/triage'];\n\n    async handle(ctx: BotContext): Promise<BotResponse> {\n        // Curator auto-triages issues\n        const analysis = this.analyzeContent(ctx.body, ctx.query);\n\n        const body = this.formatAnalysis(analysis);\n\n        return {\n            body,\n            handled: true,\n            postComment: true,\n            addLabels: analysis.labels,\n        };\n    }\n\n    private analyzeContent(\n        body: string,\n        query: string\n    ): {\n        type: string;\n        priority: string;\n        effort: string;\n        agent: string;\n        labels: string[];\n    } {\n        const combined = `${body} ${query}`.toLowerCase();\n\n        let type = 'chore';\n        let priority = 'medium';\n        let effort = 'm';\n        let agent = 'ollama';\n        const labels: string[] = [];\n\n        // Detect type\n        if (combined.includes('bug') || combined.includes('error') || combined.includes('crash') || combined.includes('broken') || combined.includes('fix') || combined.includes('issue') || combined.includes('problem') || combined.includes('fail')) {\n            type = 'bug';\n            labels.push('bug');\n            priority = 'high';\n            agent = 'cursor';\n        } else if (combined.includes('feature') || combined.includes('add') || combined.includes('implement') || combined.includes('create') || combined.includes('new') || combined.includes('enhance') || combined.includes('request')) {\n            type = 'feature';\n            labels.push('enhancement');\n            agent = 'jules';\n        } else if (combined.includes('question') || combined.includes('how') || combined.includes('what') || combined.includes('why') || combined.includes('help') || combined.includes('confused') || combined.includes('?')) {\n            type = 'question';\n            labels.push('question');\n            priority = 'low';\n            agent = 'sage';\n        } else if (combined.includes('doc') || combined.includes('readme') || combined.includes('typo') || combined.includes('spelling') || combined.includes('grammar')) {\n            type = 'docs';\n            labels.push('documentation');\n            priority = 'low';\n            agent = 'jules';\n        } else if (combined.includes('refactor') || combined.includes('clean') || combined.includes('organize') || combined.includes('improve') || combined.includes('performance') || combined.includes('optimize')) {\n            type = 'chore';\n            labels.push('refactor');\n            agent = 'jules';\n        }\n\n        // Detect priority\n        if (combined.includes('urgent') || combined.includes('critical') || combined.includes('blocker') || combined.includes('asap') || combined.includes('production') || combined.includes('breaking') || combined.includes('p0') || combined.includes('p1')) {\n            priority = 'critical';\n            labels.push('priority:critical');\n        } else if (combined.includes('security') || combined.includes('vulnerability') || combined.includes('cve') || combined.includes('exploit') || combined.includes('auth') || combined.includes('password')) {\n            priority = 'critical';\n            labels.push('security');\n        } else if (combined.includes('important') || combined.includes('high') || combined.includes('soon') || combined.includes('p2')) {\n            priority = 'high';\n            labels.push('priority:high');\n        } else if (combined.includes('low') || combined.includes('minor') || combined.includes('nice.to.have') || combined.includes('p3') || combined.includes('p4')) {\n            priority = 'low';\n            labels.push('priority:low');\n        }\n\n        // Detect effort\n        if (combined.includes('quick') || combined.includes('simple') || combined.includes('small') || combined.includes('minor') || combined.includes('trivial') || combined.includes('one.line') || combined.includes('typo')) {\n            effort = 'xs';\n            labels.push('good first issue');\n        } else if (combined.includes('complex') || combined.includes('large') || combined.includes('major') || combined.includes('overhaul') || combined.includes('rewrite') || combined.includes('epic')) {\n            effort = 'xl';\n            agent = 'cursor';\n        }\n\n        return { type, priority, effort, agent, labels };\n    }\n\n    private formatAnalysis(analysis: {\n        type: string;\n        priority: string;\n        effort: string;\n        agent: string;\n        labels: string[];\n    }): string {\n        const priorityEmoji: Record<string, string> = {\n            critical: 'üî¥',\n            high: 'üü†',\n            medium: 'üü°',\n            low: '‚ö™',\n        };\n\n        const typeEmoji: Record<string, string> = {\n            bug: 'üêõ',\n            feature: '‚ú®',\n            question: '‚ùì',\n            docs: 'üìö',\n            chore: 'üîß',\n        };\n\n        return `üìã **@curator** Triage\n\n| Field | Value |\n|-------|-------|\n| Type | ${typeEmoji[analysis.type] || ''} \\`${analysis.type}\\` |\n| Priority | ${priorityEmoji[analysis.priority] || ''} \\`${analysis.priority}\\` |\n| Effort | \\`${analysis.effort}\\` |\n| Agent | \\`@${analysis.agent}\\` |\n\n---\n_Use \\`@${analysis.agent}\\` to start work on this issue._`;\n    }\n}\n"],"mappings":"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","names":[]}