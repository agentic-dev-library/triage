{"version":3,"sources":["../src/guardian.ts"],"sourcesContent":["/**\n * @guardian Bot - Enterprise standards enforcement\n */\n\nimport type { Bot, BotContext, BotResponse } from './router.js';\n\ninterface Violation {\n    check: string;\n    status: 'pass' | 'fail' | 'skip';\n    details?: string;\n}\n\nexport class GuardianBot implements Bot {\n    name = 'guardian';\n    triggers = ['@guardian', '/guardian', '/standards', '/lint-pr'];\n\n    // Configurable settings\n    private allowedLicenses = ['MIT', 'Apache-2.0', 'BSD-2-Clause', 'BSD-3-Clause', 'ISC', 'Unlicense'];\n    private forbiddenLicenses = ['GPL', 'LGPL', 'AGPL', 'SSPL', 'Commons-Clause'];\n\n    async handle(ctx: BotContext): Promise<BotResponse> {\n        const query = ctx.query.toLowerCase().trim();\n\n        if (query === 'help' || query === '') {\n            return this.handleHelp();\n        }\n\n        // Run all checks\n        const violations = await this.runChecks(ctx);\n\n        return {\n            body: this.formatReport(violations),\n            handled: true,\n            postComment: true,\n        };\n    }\n\n    private async runChecks(_ctx: BotContext): Promise<Violation[]> {\n        const violations: Violation[] = [];\n\n        // SHA Pinning (would need file access)\n        violations.push({\n            check: 'sha-pinning',\n            status: 'skip',\n            details: 'Requires repository checkout',\n        });\n\n        // Conventional Commits (can check from context)\n        // In a real implementation, we'd check the PR title\n        violations.push({\n            check: 'conventional-commits',\n            status: 'skip',\n            details: 'Requires PR title access',\n        });\n\n        // License\n        violations.push({\n            check: 'license',\n            status: 'skip',\n            details: 'Requires file access',\n        });\n\n        // Semver\n        violations.push({\n            check: 'semver',\n            status: 'skip',\n            details: 'Requires package.json access',\n        });\n\n        // Changelog\n        violations.push({\n            check: 'changelog',\n            status: 'skip',\n            details: 'Requires file access',\n        });\n\n        return violations;\n    }\n\n    private formatReport(violations: Violation[]): string {\n        const passCount = violations.filter((v) => v.status === 'pass').length;\n        const failCount = violations.filter((v) => v.status === 'fail').length;\n        const skipCount = violations.filter((v) => v.status === 'skip').length;\n\n        let body = `ðŸ›¡ï¸ **@guardian** Enterprise Standards Check\n\n**Results**: ${passCount} passed, ${failCount} failed, ${skipCount} skipped\n\n| Check | Status | Details |\n|-------|--------|---------|`;\n\n        for (const v of violations) {\n            const statusEmoji = v.status === 'pass' ? 'âœ…' : v.status === 'fail' ? 'âŒ' : 'â­ï¸';\n            body += `\\n| ${v.check} | ${statusEmoji} | ${v.details || '-'} |`;\n        }\n\n        if (failCount > 0) {\n            body += '\\n\\n---\\nâš ï¸ **Action Required**: Fix the failing checks before merge.';\n        } else if (skipCount === violations.length) {\n            body += `\\n\\n---\\n_Run as a GitHub Action for full checks._`;\n        }\n\n        return body;\n    }\n\n    private handleHelp(): BotResponse {\n        return {\n            body: `ðŸ›¡ï¸ **@guardian** - Enterprise Standards Enforcement\n\n## Checks\n\n| Check | Description |\n|-------|-------------|\n| \\`sha-pinning\\` | GitHub Actions pinned to exact SHAs |\n| \\`conventional-commits\\` | PR titles follow conventional commit format |\n| \\`license\\` | MIT license, no GPL/LGPL |\n| \\`semver\\` | Valid semantic versioning |\n| \\`changelog\\` | CHANGELOG.md exists and is updated |\n| \\`branch-naming\\` | Branch follows naming convention |\n| \\`required-files\\` | Required files exist (LICENSE, README) |\n\n## Usage\n\n- \\`@guardian\\` - Run all checks\n- \\`@guardian check sha-pinning\\` - Run specific check\n- \\`@guardian help\\` - Show this help\n\n## Allowed Licenses\n\n${this.allowedLicenses.map((l) => `\\`${l}\\``).join(', ')}\n\n## Forbidden Licenses\n\n${this.forbiddenLicenses.map((l) => `\\`${l}\\``).join(', ')}`,\n            handled: true,\n            postComment: true,\n        };\n    }\n}\n"],"mappings":";AAYO,IAAM,cAAN,MAAiC;AAAA,EACpC,OAAO;AAAA,EACP,WAAW,CAAC,aAAa,aAAa,cAAc,UAAU;AAAA;AAAA,EAGtD,kBAAkB,CAAC,OAAO,cAAc,gBAAgB,gBAAgB,OAAO,WAAW;AAAA,EAC1F,oBAAoB,CAAC,OAAO,QAAQ,QAAQ,QAAQ,gBAAgB;AAAA,EAE5E,MAAM,OAAO,KAAuC;AAChD,UAAM,QAAQ,IAAI,MAAM,YAAY,EAAE,KAAK;AAE3C,QAAI,UAAU,UAAU,UAAU,IAAI;AAClC,aAAO,KAAK,WAAW;AAAA,IAC3B;AAGA,UAAM,aAAa,MAAM,KAAK,UAAU,GAAG;AAE3C,WAAO;AAAA,MACH,MAAM,KAAK,aAAa,UAAU;AAAA,MAClC,SAAS;AAAA,MACT,aAAa;AAAA,IACjB;AAAA,EACJ;AAAA,EAEA,MAAc,UAAU,MAAwC;AAC5D,UAAM,aAA0B,CAAC;AAGjC,eAAW,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACb,CAAC;AAID,eAAW,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACb,CAAC;AAGD,eAAW,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACb,CAAC;AAGD,eAAW,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACb,CAAC;AAGD,eAAW,KAAK;AAAA,MACZ,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,SAAS;AAAA,IACb,CAAC;AAED,WAAO;AAAA,EACX;AAAA,EAEQ,aAAa,YAAiC;AAClD,UAAM,YAAY,WAAW,OAAO,CAAC,MAAM,EAAE,WAAW,MAAM,EAAE;AAChE,UAAM,YAAY,WAAW,OAAO,CAAC,MAAM,EAAE,WAAW,MAAM,EAAE;AAChE,UAAM,YAAY,WAAW,OAAO,CAAC,MAAM,EAAE,WAAW,MAAM,EAAE;AAEhE,QAAI,OAAO;AAAA;AAAA,eAEJ,SAAS,YAAY,SAAS,YAAY,SAAS;AAAA;AAAA;AAAA;AAK1D,eAAW,KAAK,YAAY;AACxB,YAAM,cAAc,EAAE,WAAW,SAAS,WAAM,EAAE,WAAW,SAAS,WAAM;AAC5E,cAAQ;AAAA,IAAO,EAAE,KAAK,MAAM,WAAW,MAAM,EAAE,WAAW,GAAG;AAAA,IACjE;AAEA,QAAI,YAAY,GAAG;AACf,cAAQ;AAAA,IACZ,WAAW,cAAc,WAAW,QAAQ;AACxC,cAAQ;AAAA;AAAA;AAAA;AAAA,IACZ;AAEA,WAAO;AAAA,EACX;AAAA,EAEQ,aAA0B;AAC9B,WAAO;AAAA,MACH,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBhB,KAAK,gBAAgB,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,EAItD,KAAK,kBAAkB,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC;AAAA,MAC9C,SAAS;AAAA,MACT,aAAa;AAAA,IACjB;AAAA,EACJ;AACJ;","names":[]}