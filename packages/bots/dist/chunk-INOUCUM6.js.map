{"version":3,"sources":["../src/harvester.ts"],"sourcesContent":["/**\n * @harvester Bot - PR monitoring, merge queue management\n */\n\nimport type { Bot, BotContext, BotResponse } from './router.js';\n\nexport class HarvesterBot implements Bot {\n    name = 'harvester';\n    triggers = ['@harvester', '/harvester', '/merge-queue', '/mq'];\n\n    async handle(ctx: BotContext): Promise<BotResponse> {\n        const query = ctx.query.toLowerCase().trim();\n\n        // Parse commands\n        if (query === 'status' || query === '') {\n            return this.handleStatus(ctx);\n        }\n\n        if (query === 'add' || query.startsWith('add ')) {\n            return this.handleAdd(ctx);\n        }\n\n        if (query === 'remove' || query.startsWith('remove ')) {\n            return this.handleRemove(ctx);\n        }\n\n        if (query === 'help') {\n            return this.handleHelp();\n        }\n\n        return {\n            body: `ðŸŒ¾ **@harvester** - Unknown command: \\`${query}\\`\n\nUse \\`@harvester help\\` for available commands.`,\n            handled: true,\n            postComment: true,\n        };\n    }\n\n    private handleStatus(_ctx: BotContext): BotResponse {\n        // This would query the actual merge queue\n        // For now, return a template\n        return {\n            body: `ðŸŒ¾ **@harvester** Merge Queue Status\n\n| Position | PR | Status | Priority |\n|----------|-----|--------|----------|\n| 1 | #123 | âœ… Ready | High |\n| 2 | #456 | ðŸ”„ CI Running | Normal |\n| 3 | #789 | â³ Review Pending | Low |\n\n---\nCommands:\n- \\`@harvester add\\` - Add this PR to queue\n- \\`@harvester remove\\` - Remove from queue\n- \\`@harvester status\\` - Show queue status`,\n            handled: true,\n            postComment: true,\n        };\n    }\n\n    private handleAdd(ctx: BotContext): BotResponse {\n        if (!ctx.isPR) {\n            return {\n                body: 'ðŸŒ¾ **@harvester** can only add Pull Requests to the merge queue.',\n                handled: true,\n                postComment: true,\n            };\n        }\n\n        return {\n            body: `ðŸŒ¾ **@harvester**\n\nâœ… Added PR #${ctx.number} to the merge queue.\n\nI'll monitor CI status and merge when:\n1. All checks pass\n2. Reviews are approved\n3. No merge conflicts\n\nUse \\`@harvester remove\\` to remove from queue.`,\n            handled: true,\n            postComment: true,\n            addLabels: ['merge-queue'],\n        };\n    }\n\n    private handleRemove(ctx: BotContext): BotResponse {\n        if (!ctx.isPR) {\n            return {\n                body: 'ðŸŒ¾ **@harvester** can only remove Pull Requests from the merge queue.',\n                handled: true,\n                postComment: true,\n            };\n        }\n\n        return {\n            body: `ðŸŒ¾ **@harvester**\n\nâŒ Removed PR #${ctx.number} from the merge queue.`,\n            handled: true,\n            postComment: true,\n            addLabels: [],\n            // Would remove 'merge-queue' label\n        };\n    }\n\n    private handleHelp(): BotResponse {\n        return {\n            body: `ðŸŒ¾ **@harvester** - Merge Queue Management\n\n## Commands\n\n| Command | Description |\n|---------|-------------|\n| \\`@harvester status\\` | Show merge queue status |\n| \\`@harvester add\\` | Add this PR to queue |\n| \\`@harvester remove\\` | Remove from queue |\n| \\`@harvester help\\` | Show this help |\n\n## How It Works\n\n1. Add PRs to the queue with \\`@harvester add\\`\n2. Harvester monitors CI status automatically\n3. When a PR passes all checks and is approved, it merges\n4. Conflicts are auto-rebased when possible\n\n## Priority\n\nPRs are merged in order based on:\n1. Priority labels (\\`priority:critical\\` > \\`priority:high\\` > default)\n2. Time in queue (older first)\n3. Approval status`,\n            handled: true,\n            postComment: true,\n        };\n    }\n}\n"],"mappings":";AAMO,IAAM,eAAN,MAAkC;AAAA,EACrC,OAAO;AAAA,EACP,WAAW,CAAC,cAAc,cAAc,gBAAgB,KAAK;AAAA,EAE7D,MAAM,OAAO,KAAuC;AAChD,UAAM,QAAQ,IAAI,MAAM,YAAY,EAAE,KAAK;AAG3C,QAAI,UAAU,YAAY,UAAU,IAAI;AACpC,aAAO,KAAK,aAAa,GAAG;AAAA,IAChC;AAEA,QAAI,UAAU,SAAS,MAAM,WAAW,MAAM,GAAG;AAC7C,aAAO,KAAK,UAAU,GAAG;AAAA,IAC7B;AAEA,QAAI,UAAU,YAAY,MAAM,WAAW,SAAS,GAAG;AACnD,aAAO,KAAK,aAAa,GAAG;AAAA,IAChC;AAEA,QAAI,UAAU,QAAQ;AAClB,aAAO,KAAK,WAAW;AAAA,IAC3B;AAEA,WAAO;AAAA,MACH,MAAM,iDAA0C,KAAK;AAAA;AAAA;AAAA,MAGrD,SAAS;AAAA,MACT,aAAa;AAAA,IACjB;AAAA,EACJ;AAAA,EAEQ,aAAa,MAA+B;AAGhD,WAAO;AAAA,MACH,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAaN,SAAS;AAAA,MACT,aAAa;AAAA,IACjB;AAAA,EACJ;AAAA,EAEQ,UAAU,KAA8B;AAC5C,QAAI,CAAC,IAAI,MAAM;AACX,aAAO;AAAA,QACH,MAAM;AAAA,QACN,SAAS;AAAA,QACT,aAAa;AAAA,MACjB;AAAA,IACJ;AAEA,WAAO;AAAA,MACH,MAAM;AAAA;AAAA,mBAEJ,IAAI,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQZ,SAAS;AAAA,MACT,aAAa;AAAA,MACb,WAAW,CAAC,aAAa;AAAA,IAC7B;AAAA,EACJ;AAAA,EAEQ,aAAa,KAA8B;AAC/C,QAAI,CAAC,IAAI,MAAM;AACX,aAAO;AAAA,QACH,MAAM;AAAA,QACN,SAAS;AAAA,QACT,aAAa;AAAA,MACjB;AAAA,IACJ;AAEA,WAAO;AAAA,MACH,MAAM;AAAA;AAAA,qBAEF,IAAI,MAAM;AAAA,MACd,SAAS;AAAA,MACT,aAAa;AAAA,MACb,WAAW,CAAC;AAAA;AAAA,IAEhB;AAAA,EACJ;AAAA,EAEQ,aAA0B;AAC9B,WAAO;AAAA,MACH,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAwBN,SAAS;AAAA,MACT,aAAa;AAAA,IACjB;AAAA,EACJ;AACJ;","names":[]}